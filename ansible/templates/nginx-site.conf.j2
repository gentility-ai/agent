server {
    listen 80;
    server_name {{ domain }};
    root {{ web_root }};
    index index.html;

    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
    add_header Referrer-Policy "strict-origin-when-cross-origin";

    # Debian repository specific configuration
    location /debian/ {
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        
        # Allow package manager access
        location ~* \.(deb|gz|bz2|xz|Release|Packages)$ {
            expires 1h;
            add_header Cache-Control "public, immutable";
        }
        
        # Security for Release files
        location ~ /Release$ {
            expires 1h;
            add_header Cache-Control "public, must-revalidate";
        }
        
        # GPG signatures
        location ~* \.(gpg|asc)$ {
            expires 24h;
            add_header Cache-Control "public, immutable";
        }
    }

    # GPG key at root level
    location /gentility-packages.gpg {
        expires 24h;
        add_header Cache-Control "public, immutable";
    }

    # Main directory listing
    location / {
        try_files $uri $uri/ =404;
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
    }

    # Deny access to hidden files
    location ~ /\. {
        deny all;
    }

    # Logging
    access_log /var/log/nginx/{{ domain }}_access.log;
    error_log /var/log/nginx/{{ domain }}_error.log;
}